{% extends 'base_admin.html.twig' %}

{% block title 'Edit page magazine' %}

{% block body %}
    <div class="container"> 
        {% for message in app.Flashes('success') %}
                <div class="alert alert-success alert-dismissible fade show text-center" role="alert" id="success">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                        {{ message }}
                </div>
        {% endfor %}
        {# gestion contenue page #}
        <div class="row">
           <div class="col-xl-12 col-lg-12">
                <div class="card shadow mb-5">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">
                               Gestion page magazine
                            </h6>
                        </div>
                        <div class="card-body">

                            {{ form_start(formGrandeBan, {'attr': {'class': 'row col-12 mb-3'}}) }}
                            <div class="col-lg-10">
                                <div class="form-group">
                                    <label class="control-label required" for="">Grande bannière (Format Image: Jpeg, Paysage,  Taille Max: 2Mo)</label>
                                    {{ form_row(formGrandeBan.imagMag, {'label': ' '}) }}
                                    {{ form_errors(formGrandeBan.imagMag) }}
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label for="">Mettre à jour</label>
                                    <button type="submit" class="btn btn-secondary w-100">Enregistrer</button>
                                </div>
                            </div>
                            {{ form_end(formGrandeBan) }}

                            {{ form_start(formEdition, {'attr': {'class': 'row col-12 mb-3'}}) }}
                            <div class="col-lg-10">
                                <div class="form-group">
                                    <label class="control-label required" for="">Numéro d'édition</label>
                                    {{ form_widget(formEdition.TextMag, {'label': ' '}) }}
                                    {{ form_errors(formEdition.TextMag) }}
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label for="">Mettre à jour</label>
                                    <button type="submit" class="btn btn-secondary w-100">Enregistrer</button>
                                </div>
                            </div>
                            {{ form_end(formEdition) }}

                            {{ form_start(formDosSpec, {'attr': {'class': 'row col-12 mb-3'}}) }}
                            <div class="col-lg-10">
                                <div class="form-group">
                                    <label class="control-label required" for="">Dossier spécial</label>
                                    {{ form_widget(formDosSpec.TextMag, {'label': ' '}) }}
                                    {{ form_errors(formDosSpec.TextMag) }}
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label for="">Mettre à jour</label>
                                    <button type="submit" class="btn btn-secondary w-100">Enregistrer</button>
                                </div>
                            </div>
                            {{ form_end(formDosSpec) }}

                            {{ form_start(formImg1, {'attr': {'class': 'row col-12 mb-3'}}) }}
                            <div class="col-lg-10">
                                <div class="form-group">
                                    <label class="control-label required" for="">Image bloc1_2 (Format Image: Jpeg, Paysage, Taille Max: 2Mo)</label>
                                    {{ form_row(formImg1.imagMag, {'label': ' '}) }}
                                    {{ form_errors(formImg1.imagMag) }}
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label for="">Mettre à jour</label>
                                    <button type="submit" class="btn btn-secondary w-100">Enregistrer</button>
                                </div>
                            </div>
                            {{ form_end(formImg1) }}

                            {{ form_start(formTitreImg1, {'attr': {'class': 'row col-12 mb-3'}}) }}
                            <div class="col-lg-10">
                                <div class="form-group">
                                    <label class="control-label required" for="">Titre bloc1_2</label>
                                    {{ form_widget(formTitreImg1.TextMag, {'label': ' '}) }}
                                    {{ form_errors(formTitreImg1.TextMag) }}
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label for="">Mettre à jour</label>
                                    <button type="submit" class="btn btn-secondary w-100">Enregistrer</button>
                                </div>
                            </div>
                            {{ form_end(formTitreImg1) }}

                            {{ form_start(formImg2, {'attr': {'class': 'row col-12 mb-3'}}) }}
                            <div class="col-lg-10">
                                <div class="form-group">
                                    <label class="control-label required" for="">Image bloc1_3 (Format Image: Jpeg, Portrait, Taille Max: 2Mo)</label>
                                    {{ form_row(formImg2.imagMag, {'label': ' '}) }}
                                    {{ form_errors(formImg2.imagMag) }}
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label for="">Mettre à jour</label>
                                    <button type="submit" class="btn btn-secondary w-100">Enregistrer</button>
                                </div>
                            </div>
                            {{ form_end(formImg2) }}

                            {{ form_start(formGdTitre, {'attr': {'class': 'row col-12 mb-3'}}) }}
                            <div class="col-lg-10">
                                <div class="form-group">
                                    <label class="control-label required" for="">Grand titre : 30 caractères Max</label>
                                    {{ form_widget(formGdTitre.TextMag, {'label': ' '}) }}
                                    {{ form_errors(formGdTitre.TextMag) }}
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label for="">Mettre à jour</label>
                                    <button type="submit" class="btn btn-secondary w-100">Enregistrer</button>
                                </div>
                            </div>
                            {{ form_end(formGdTitre) }}

                            {{ form_start(formImg3, {'attr': {'class': 'row col-12 mb-3'}}) }}
                            <div class="col-lg-10">
                                <div class="form-group">
                                    <label class="control-label required" for="">Image bloc2_1 (Format Image: Jpeg, Paysage Taille Max: 2Mo)</label>
                                    {{ form_row(formImg3.imagMag, {'label': ' '}) }}
                                    {{ form_errors(formImg3.imagMag) }}
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label for="">Mettre à jour</label>
                                    <button type="submit" class="btn btn-secondary w-100">Enregistrer</button>
                                </div>
                            </div>
                            {{ form_end(formImg3) }}

                            {{ form_start(formSomm, {'attr': {'class': 'row col-12 mb-3'}}) }}
                            <div class="col-lg-10">
                                <div class="form-group">
                                    <label class="control-label required" for="">Sommaire</label>
                                    {{ form_widget(formSomm.TextMag, {'label': ' '}) }}
                                    {{ form_errors(formSomm.TextMag) }}
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label for="">Mettre à jour</label>
                                    <button type="submit" class="btn btn-secondary w-100">Enregistrer</button>
                                </div>
                            </div>
                            {{ form_end(formSomm) }}
                        </div>

                </div>

                        <div class="col-lg-12 mb-5 mt-3">
                            <div style="background: white; border-radius: .6rem; border-left: 0.25rem solid #1cc88a !important; border-right: 0.25rem solid #1cc88a !important; padding: 2rem; box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15) !important;">
                                <span>Gestion Page Magazine</span>
                                
                                {# edition #}
                                {% for magText in magText %}
                                    <p><a href="{{ path('edit-edition', {'id': magText.id }) }}"><i class="fa fa-edit"></i> </a> <a href="{{ path('delete-puce', {'id': magText.id }) }}" onclick="return confirm('Voulez-vous supprimer cette ligne')"><i class="fa fa-trash text-danger"></i></a> - {{magText.TextMag}}</p>
                                {% endfor %}

                                {# dossier special #}
                                {% for magTextspec in magTextspec %}
                                    <p><a href="{{ path('edit-textspec', {'id': magTextspec.id }) }}"><i class="fa fa-edit"></i> </a> <a href="{{ path('delete-puce', {'id': magTextspec.id }) }}" onclick="return confirm('Voulez-vous supprimer cette ligne')"><i class="fa fa-trash text-danger"></i></a> - {{magTextspec.TextMag}}</p>
                                {% endfor %}

                                {# titre bloc b1_2 #}
                                {% for magTexttitre in magTexttitre %}
                                    <p><a href="{{ path('edit-texttitre', {'id': magTexttitre.id }) }}"><i class="fa fa-edit"></i> </a> <a href="{{ path('delete-puce', {'id': magTexttitre.id }) }}" onclick="return confirm('Voulez-vous supprimer cette ligne')"><i class="fa fa-trash text-danger"></i></a> - {{magTexttitre.TextMag}}</p>
                                {% endfor %}

                                {# grand titre #}
                                {% for magTextgdtitre in magTextgdtitre %}
                                    <p><a href="{{ path('edit-gdtitre', {'id': magTextgdtitre.id }) }}"><i class="fa fa-edit"></i> </a> <a href="{{ path('delete-puce', {'id': magTextgdtitre.id }) }}" onclick="return confirm('Voulez-vous supprimer cette ligne')"><i class="fa fa-trash text-danger"></i></a> - {{magTextgdtitre.TextMag}}</p>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="col-lg-12 mb-5 mt-3">
                            <div style="background: white; border-radius: .6rem; border-left: 0.25rem solid #1cc88a !important; border-right: 0.25rem solid #1cc88a !important; padding: 2rem; box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15) !important;">
                                <span>Bloc sommaire</span>
                                
                                {% for puce in puce %}
                                    <p><a href="{{ path('edit-puce', {'id': puce.id }) }}"><i class="fa fa-edit"></i> </a> <a href="{{ path('delete-puce', {'id': puce.id }) }}" onclick="return confirm('Voulez-vous supprimer cette ligne')"><i class="fa fa-trash text-danger"></i></a> - {{puce.TextMag|raw}}</p>
                                {% endfor %}
                            </div>
                        </div>

                        {# gestion image #}

                                        {# Menu du header #}
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Listes des images</h6>
                    </div>
                    <div class="card-body live-search-list">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th scope="col">Options</th>
                                <th scope="col">Nom</th>
                                <th scope="col">Image</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for magContent in magContents %}
                                <tr class="search">
                                    <th scope="row">
                                        <form method="post" action="{{ path('admin_delete_image', {id: magContent.id}) }}" style="display: inline-block">
                                            <input type="hidden" name="_method" value="DELETE">
                                            <input type="hidden" name="_token" value="{{ csrf_token("delete" ~ magContent.id) }}">
                                            <button class="btn btn-danger btn-circle btn-sm" onclick="return confirm('ATTENTION : Êtes-vous sûr de bien vouloir supprimer cette image ?;">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                        <a href="{{ path('admin_edit_image', {id: magContent.id}) }}" class="btn btn-primary btn-circle btn-sm">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </th>
                                    <td>Grande Bannière</td>
                                    <td class="position-relative p-0 m-1">
                                        <img src="{{ asset('assets/images/magazine/'~magContent.imagMag) }}" class="position-absolute rounded d-block" style="width: 100%;height:100;">
                                    </td>
                                </tr>
                            {% endfor %}

                            {% for magContent1 in magContents1 %}
                                <tr class="search">
                                    <th scope="row">
                                        <form method="post" action="{{ path('admin_delete_image', {id: magContent1.id}) }}" style="display: inline-block">
                                            <input type="hidden" name="_method" value="DELETE">
                                            <input type="hidden" name="_token" value="{{ csrf_token("delete" ~ magContent1.id) }}">
                                            <button class="btn btn-danger btn-circle btn-sm" onclick="return confirm('ATTENTION : Êtes-vous sûr de bien vouloir supprimer cette image ?;">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                        <a href="{{ path('admin_edit_image1', {id: magContent1.id}) }}" class="btn btn-primary btn-circle btn-sm">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </th>
                                    <td>Image bloc 1_2</td>
                                    <td class="position-relative p-0 m-1">
                                        <img src="{{ asset('assets/images/magazine/'~magContent1.imagMag) }}" class="position-absolute rounded d-block" style="width: 100%;height:100%;">
                                    </td>
                                </tr>    
                            {% endfor %}

                             {% for magContent2 in magContents2 %}
                                <tr class="search">
                                    <th scope="row">
                                        <form method="post" action="{{ path('admin_delete_image', {id: magContent2.id}) }}" style="display: inline-block">
                                            <input type="hidden" name="_method" value="DELETE">
                                            <input type="hidden" name="_token" value="{{ csrf_token("delete" ~ magContent2.id) }}">
                                            <button class="btn btn-danger btn-circle btn-sm" onclick="return confirm('ATTENTION : Êtes-vous sûr de bien vouloir supprimer cette image ?;">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                        <a href="{{ path('admin_edit_image2', {id: magContent2.id}) }}" class="btn btn-primary btn-circle btn-sm">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </th>
                                    <td>Image bloc 1_3</td>
                                    <td class="position-relative p-0 m-1">
                                        <img src="{{ asset('assets/images/magazine/'~magContent2.imagMag) }}" class="position-absolute rounded d-block" style="width: 100%;height:100%;">
                                    </td>
                                </tr>    
                            {% endfor %}

                            {% for magContent3 in magContents3 %}
                                <tr class="search">
                                    <th scope="row">
                                        <form method="post" action="{{ path('admin_delete_image', {id: magContent3.id}) }}" style="display: inline-block">
                                            <input type="hidden" name="_method" value="DELETE">
                                            <input type="hidden" name="_token" value="{{ csrf_token("delete" ~ magContent3.id) }}">
                                            <button class="btn btn-danger btn-circle btn-sm" onclick="return confirm('ATTENTION : Êtes-vous sûr de bien vouloir supprimer cette image ?;">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                        <a href="{{ path('admin_edit_image3', {id: magContent3.id}) }}" class="btn btn-primary btn-circle btn-sm">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </th>
                                    <td>Image bloc 2_1</td>
                                    <td class="position-relative p-0 m-1">
                                        <img src="{{ asset('assets/images/magazine/'~magContent3.imagMag) }}" class="position-absolute rounded d-block" style="width: 100%;height:100%;">
                                    </td>
                                </tr>    
                            {% endfor %}
                            </tbody>
                        </table>
                        {% include("admin/_no-result.html.twig") %}
                    </div>
                </div>


        {# gestion des articles #}
        {{ form_start(form, {'attr': {'class':'row user'}}) }}

            <div class="col-xl-12 col-lg-7">

                {# Menu du magazine #}
                <div class="card shadow mb-5">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Ajouter un nouvel article</h6>
                    </div>
                    <div class="card-body">
                        <div class="col-sm-12 mb-3 mb-sm-0 mx-auto">
                            {{ form_widget(form.titles, { 'attr': {'placeholder': 'Titre de l\'article'}}) }}
                            {{ form_errors(form.titles) }}
                        </div>
                        <div class="mt-5">
                            {{ form_widget(form.contents) }}
                            {{ form_errors(form.contents) }}
                        </div>
                        
                        <div class="mt-5 mb-4">
                            <label class="control-label" for="imagArt">Image article (Format Image: Jpeg,Png,Gif 400x400px, Portrait,  Taille Max: 2Mo)</label>
                            <div>
                                {{ form_widget(form.imagArt) }}
                                {{ form_errors(form.imagArt) }}
                            </div>
                        </div>
                        <div class="shadow mb-4">
                        <div class="card-body">
                        <button class="btn btn-primary btn-user btn-block mt-3">
                            Ajouter l'article
                        </button>
                    </div>
                </div>
                    </div>
                </div>

            </div>

        {{ form_end(form) }}

        {# listes des articles #}
        <div class="row">

            <div class="col-xl-12 col-lg-12">

                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">
                            Liste des articles
                        </h6>
                    </div>
                    {% for message in app.Flashes('success') %}
                        <div class="alert alert-success alert-dismissible fade show" role="alert" id="success">
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            {{ message }}
                        </div>
                    {% endfor %}
                    {% include("admin/_no-result.html.twig") %}
                    <div class="row live-search-list">

                        {% if articles is not empty %}

                            {% for article in articles %}
                                <div class="col-md-6 search">
                                    <div class="card-body">
                                        <div class="card text-white border-primary bg-primary p-1 mb-3 text-center">
                                            <div class="card-body">
                                                <h2 class="card-title d-block text-truncate">{{ article.titles }}</h2>
                                                <p class="card-text d-block text-truncate">Article du {{ article.createdAt|date('d/m/Y') }} </p>

                                                <form method="post" action="{{ path('admin_articles_delete', {id: article.id}) }}" style="display: inline-block">
                                                    <input type="hidden" name="_method" value="DELETE">
                                                    <input type="hidden" name="_token" value="{{ csrf_token("delete" ~ article.id) }}">
                                                    <button class="btn btn-danger btn-sm" onclick="return confirm('ATTENTION : Êtes-vous sûr de bien vouloir supprimer cet article ? \n');">
                                                        <i class="fas fa-trash"></i>
                                                        Supprimer
                                                    </button>
                                                </form>

                                                <a href="{{ path('admin_article_edit',{'id': article.id }) }}" class="btn btn-primary btn-sm">
                                                    <i class="fas fa-edit"></i>
                                                    Modifier
                                                </a>
                                                <a href="{{ path('articles_view', {'slug': article.slug, 'id': article.id }) }}" target="_blank" class="btn btn-primary btn-sm">
                                                    <i class="far fa-eye"></i>
                                                    Voir l'article
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <form method="post" action="{{ path('admin_magazine') }}" class="col-md-12 text-center mt-5 mb-5 pl-3 pr-3">
                                <h5 class="mb-3">il y a actuellement aucun article</h5>
                                <button class="btn btn-primary">Ajoutez votre première article</button>
                            </form>
                        {% endif %}
                    </div>
                </div>

            </div>

        </div>

           </div>
        </div>

    </div>
{% endblock %}


{% block javascripts %}
    <script src="{{ asset('assets/admin/vendor/ckeditor/ckeditor.js') }}"></script>
    <script>
        {# Remplace le textarea par le plugin Ckeditor #}
        CKEDITOR.replace('articles_mag[contents]', {
            language: 'fr'
        });
    </script>
{% endblock %}